function sortable_accordion(){$(".section_accordion").accordion({collapsible:!0,active:!1,heightStyle:"content",header:"> section > h3"}).sortable({axis:"y",handle:"h3",items:".section_sortable",placeholder:"section_highlight",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),$(this).accordion("refresh")}}),$(".article_accordion").accordion({collapsible:!0,active:!1,heightStyle:"content",header:"> article >h4"}).sortable({axis:"y",handle:"h4",items:".article_sortable",placeholder:"article_highlight",stop:function(e,t){t.item.children("h4").triggerHandler("focusout"),$(this).accordion("refresh")}})}function DisplaySortOrder(){$.ajax({url:"index.php?Presentations&action=displaySortOrder",type:"POST",data:{PresentationId:$("#PresentationId").val(),CategoryId:$("#CategoryId").val()},dataType:"html",success:function(e,t){$("#SortOrder").empty(),$(e).appendTo("#SortOrder"),$("#UpdateCategory").removeClass("invisible"),$("#ConfirmDeleteCategory").removeClass("invisible"),$("#NewCategory").css("border","#ccc solid 1px"),$("#NewCategory").attr("placeholder","Nouvelle catégorie"),$("#NewCategory").val(""),$("#UpdateCategory").removeClass("hidden"),$("#SaveUpdate").addClass("hidden")}})}function updatePresentation(e){$.ajax({url:"index.php?Presentations&action=updatePresentation",type:"POST",data:{PresentationId:e},dataType:"json",success:function(e){eraseForm(),$("#error").addClass("invisible"),$("#entry-form-modal-title").text("Modifier une présentation"),$("#PresentationId").val(e.Id),$("#Title").val(e.Title),$("#Description").val(e.Description),$("#CategoryId").val(e.CategoryId),$("#StartDate").val(e.StartDate),$("#StartTime").val(e.StartTime),$("#EndTime").val(e.EndTime),$("#Location").val(e.Location),$("#Animator").val(e.Animator),$("#Institution").val(e.Institution),$("#entry-form-modal").modal("show"),DisplaySortOrder()}})}function deletePresentation(e){$.ajax({url:"index.php?Presentations&action=deletePresentation",type:"POST",data:{PresentationId:e},dataType:"html",success:function(e){$("#display_presentations").empty(),$(e).appendTo("#display_presentations"),sortable_accordion()}})}function eraseForm(){$("input").val(""),$("textarea").val(""),$("select").val("0"),$("PresentationId").val("0"),$("input").css("border","#ccc solid 1px"),$("textarea").css("border","#ccc solid 1px"),$("select").css("border","#ccc solid 1px"),$("#UpdateCategory").addClass("invisible"),$("#SaveUpdate").addClass("hidden"),$("#ConfirmDeleteCategory").addClass("invisible"),setDateTime(90)}function setDateTime(e){var t=new Date,a=("0"+t.getDate()).slice(-2),o=("0"+(t.getMonth()+1)).slice(-2),r=("0"+t.getHours()).slice(-2),i=("0"+t.getMinutes()).slice(-2),n=("0"+t.getSeconds()).slice(-2),l=+r+Math.floor(e/60),s=+i+e%60;s>59&&(s=("0"+s%60).slice(-2),("0"+l++).slice(-2),l>23&&(l="00",a=("0"+a++).slice(-2)));var d=t.getFullYear()+"-"+o+"-"+a,c=r+":"+i+":"+n,p=("0"+l).slice(-2)+":"+("0"+s).slice(-2)+":"+n;console.log(p),$("#StartDate").attr("min",d),$("#StartDate").val(d),$("#StartTime").val(c),$("#EndTime").val(p),console.log($("#StartDate").val(),$("#StartTime").val(),$("#EndTime").val())}function ResetCategoryButtons(e){$("#CategoryId").css("border","#ccc solid 1px"),$("#NewCategory").val(""),$("#NewCategory").css("border","#ccc solid 1px"),$("#UpdateCategory").removeClass("hidden"),$("#SaveUpdate").addClass("hidden"),$("#AddCategory").prop("disabled",!0),$("#SortOrder").val(e),$("#UpdateCategory").removeClass("invisible"),$("#ConfirmDeleteCategory").removeClass("invisible"),$("#AddCategory").removeClass("hidden")}$(document).ready(function(){$.ajax({url:"index.php?Presentations&action=displayPresentations",type:"POST",dataType:"html",success:function(e,t){$("#display_presentations").empty(),$(e).appendTo("#display_presentations"),sortable_accordion()}}),$.ajax({url:"index.php?Categories&action=displayCategories",type:"POST",dataType:"html",success:function(e,t){$(e).appendTo("#CategoryId")}})}),$("#AddPresentation").on("click",function(){eraseForm(),$("#error").addClass("invisible"),$("#entry-form-modal").modal("show")}),$("#CategoryId").on("click",function(){$("#SortOrder").val(null)}),$("#CategoryId").on("change",function(){DisplaySortOrder()}),$("#SavePresentation").on("click",function(){$.ajax({url:"index.php?Presentations&action=savePresentation",type:"POST",data:{PresentationId:$("#PresentationId").val(),Title:$("#Title").val(),Description:$("#Description").val(),CategoryId:$("#CategoryId").val(),SortOrder:$("#SortOrder").val(),StartDate:$("#StartDate").val(),StartTime:$("#StartTime").val(),EndTime:$("#EndTime").val(),Location:$("#Location").val(),Animator:$("#Animator").val(),Institution:$("#Institution").val()},dataType:"html",success:function(e){$("#display_presentations").empty(),$(e).appendTo("#display_presentations"),sortable_accordion()}})}),$("#Title").on("input blur",function(){""==$("#Title").val().trim()?($("#Title").css("border","red solid 2px"),$("#Title").attr("placeholder","Veuillez entrer un titre")):$("#Title").css("border","lightgreen solid 2px")}),$("#Description").on("input blur",function(){""==$("#Description").val().trim()?($("#Description").css("border","red solid 2px"),$("#Description").attr("placeholder","Veuillez entrer une description")):$("#Description").css("border","lightgreen solid 2px")}),$("#CategoryId").on("input blur",function(){null==$("#CategoryId").val()?($("#CategoryId").css("border","red solid 2px"),$("#NewCategory").css("border","#ccc solid 1px"),$("#NewCategory").attr("placeholder","Nouvelle catégorie")):$("#CategoryId").css("border","lightgreen solid 2px")}),$("#SortOrder").on("input blur",function(){null==$("#SortOrder").val()||"0"==$("#SortOrder").val()?$("#SortOrder").css("border","red solid 2px"):$("#SortOrder").css("border","lightgreen solid 2px")}),$("#StartDate").on("input blur",function(){var e=new Date,t=("0"+e.getDate()).slice(-2),a=("0"+(e.getMonth()+1)).slice(-2),o=e.getFullYear()+"-"+a+"-"+t;""==$("#StartDate").val()||$("#StartDate").val()<o?$("#StartDate").css("border","red solid 2px"):$("#StartDate").css("border","lightgreen solid 2px")}),$("#StartTime").on("input blur",function(){""==$("#StartTime").val()?$("#StartTime").css("border","red solid 2px"):$("#StartTime").css("border","lightgreen solid 2px")}),$("#EndTime").on("input blur",function(){""==$("#EndTime").val()?$("#EndTime").css("border","red solid 2px"):$("#EndTime").css("border","lightgreen solid 2px")}),$("#Location").on("input blur",function(){""==$("#Location").val().trim()?($("#Location").css("border","red solid 2px"),$("#Location").attr("placeholder","Veuillez entrer un emplacement")):$("#Location").css("border","lightgreen solid 2px")}),$("#Animator").on("input blur",function(){""==$("#Animator").val().trim()?($("#Animator").css("border","red solid 2px"),$("#Animator").attr("placeholder","Veuillez entrer un animateur")):$("#Animator").css("border","lightgreen solid 2px")}),$("#Institution").on("input blur",function(){""==$("#Institution").val().trim()?($("#Institution").css("border","red solid 2px"),$("#Institution").attr("placeholder","Veuillez entrer une institution")):$("#Institution").css("border","lightgreen solid 2px")}),$("form").on("click change mousemove",function(){""==$("#Title").val()||""==$("#Description").val()||null==$("#CategoryId").val()||""==$("#StartDate").val()||""==$("#StartTime").val()||""==$("#EndTime").val()||""==$("#Location").val()||""==$("#Animator").val()||""==$("#Institution").val()?$("#SavePresentation").prop("disabled",!0):$("#SavePresentation").prop("disabled",!1)}),$("#NewCategory").on("input blur",function(){""==$("#NewCategory").val().trim()?($("#AddCategory").prop("disabled",!0),null==$("#CategoryId").val()?($("#NewCategory").css("border","red solid 2px"),$("#NewCategory").attr("placeholder","Veuillez entrer une nouvelle catégorie")):$("#NewCategory").css("border","red solid 2px")):($("#NewCategory").css("border","lightgreen solid 2px"),$("#AddCategory").prop("disabled",!1))}),$("#AddCategory").on("click",function(){$("#CategoryId").val();$.ajax({url:"index.php?Categories&action=saveCategory",type:"POST",data:{CategoryName:$("#NewCategory").val()},dataType:"html",success:function(e){$("#CategoryId").empty(),$(e).appendTo("#CategoryId"),$("#CategoryId").children().last().attr("selected",!0),ResetCategoryButtons(e.SortOrder)}})}),$("#UpdateCategory").on("click",function(){$.ajax({url:"index.php?Categories&action=displayCategory",type:"POST",data:{CategoryId:$("#CategoryId").val()},dataType:"html",success:function(e){$("#NewCategory").val(e),$("#NewCategory").css("border","#ccc solid 1px"),$("#NewCategory").focus(),$("#AddCategory").addClass("hidden"),$("#UpdateCategory").addClass("hidden"),$("#SaveUpdate").removeClass("hidden"),$("#AddCategory").prop("disabled",!0),$("#CategoryId").css("border","#ccc solid 1px")}})}),$("#SaveUpdate").on("click",function(){var e=$("#CategoryId").val();$.ajax({url:"index.php?Categories&action=saveCategory",type:"POST",data:{CategoryId:e,CategoryName:$("#NewCategory").val()},dataType:"html",success:function(t){$("#CategoryId").empty(),$(t).appendTo("#CategoryId"),$("#CategoryId").val(e),ResetCategoryButtons(t.SortOrder)}})}),$("#ConfirmDeleteCategory").on("click",function(){$.ajax({url:"index.php?Categories&action=confirmDeleteCategory",type:"POST",data:{CategoryId:$("#CategoryId").val()},dataType:"html",success:function(e,t){$("#DeletedPresentations").empty(),$("#DeletedPresentations").html(e),$("#DeleteCategoryCollapse").collapse("show"),$("#ConfirmDeleteCategory").addClass("invisible")}})}),$("#DeleteCategory").on("click",function(){$.ajax({url:"index.php?Categories&action=deleteCategoryPresentations",type:"POST",data:{CategoryId:$("#CategoryId").val()},dataType:"html",success:function(e,t){$("#CategoryId").empty(),$(e).appendTo("#CategoryId"),$("#DeleteCategoryCollapse").collapse("hide"),$("#ConfirmDeleteCategory").addClass("invisible"),$("#UpdateCategory").addClass("invisible")}})}),$("#CancelDeleteCategory").on("click",function(){$("#ConfirmDeleteCategory").removeClass("invisible")});